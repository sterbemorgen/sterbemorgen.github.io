<div id="waline" style="min-height: 200px;"></div>

<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<script type="module">
  import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

  function initWaline() {
    const el = document.getElementById('waline');
    if (!el) return;

    const waline = init({
      el: '#waline',
      serverURL: 'https://waline-ruby-mu.vercel.app',
      login: 'disable',
      lang: 'en', // 改为英文
      dark: 'html[class*="dark"], body[class*="dark"]',
    });

    // 变色补丁：手动触发更新
    const btn = document.getElementById("theme-toggle");
    if (btn) {
      btn.onclick = () => { // 改用 onclick 确保唯一性
        setTimeout(() => {
          const isDark = document.body.classList.contains("dark") || 
                         document.documentElement.classList.contains("dark");
          waline.update({ dark: isDark });
        }, 50);
      };
    }
  }

  // 这里的逻辑是预防“找不到容器”报错的终极保险
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWaline);
  } else {
    initWaline();
  }
</script>